<script>$(document).ready(function() { $(".edit-userpic").click(function() {		$("#pictures").dialog({			dialogClass: 'userpic-dial',			height: 'auto',			width: 560,			modal: true		}).dialog( "option", "buttons", {			"Save": function() { changeUserpic( $("#used-userpic img").attr("src"))  }, 			"Cancel": function() { $(this).dialog("close"); } 			} );		//$(".userpic-dial").find(".ui-dialog-buttonset button:first").button( "option", "disabled", true );			 })   $(".userpics-list li").click(function(){	var src = $(this).find("img:first").attr("src");	$("#used-userpic").find("img:first").attr("src", src);	var txt = $(this).find("div:first").html();	$("#used-txt").html(txt);})$("#nick-blank-save").click(function() {changeNick ()});$(".edit-username").click(function() {		$( "#username" ).dialog({			dialogClass: 'username-dial',			height: 'auto',			width: 500,			open: function () {  $(this).find(".userinfo-edit input").val($("#current_name").text()).blur();  },			modal: true		}).dialog( "option", "buttons", {"Save": function() { changeNickname ()  }, "Cancel": function() { $(this).dialog("close"); } } )		.dialog({close: function(event, ui) { 			$("#username .err-block, #userpass .nick-error-msg").hide();			$("#username .userinfo-edit input").val("");		}});}) });  function changeNickname ()  {		var userName = $("#us-nickname").val();		$.post("/update_nick", { user_name: userName} );}function changeNick ()  {		var userName = $("#nick-blank").val();		if (userName.length < 2){			alertWrongNick(2);		} else if (userName.length >50){			alertWrongNick(3);		} else {			$.post("/update_nick", { user_name: userName} );		}}function alertWrongNick(status) {			var msg = '';			if (status==1) msg = $('#nick-error-msg1').text();			if (status==2) msg = $('#nick-error-msg2').text();			if (status==3) msg = $('#nick-error-msg3').text();			$('<div title="Invalid nickname" style="padding: 30px 60px; font-size: 12px;"><b>'+msg+'</b></div>').dialog({modal:true}).dialog( "option", "buttons", {"Ok": function() { $(this).dialog("close"); } } );}function userNameChanging(status,name) {	$("#username .err-block, #username .nick-error-msg").hide();	$(".username-dial .ui-dialog-buttonset img.up-loader").remove();	if (status == 0) {		var to_show = $("#un-success")		if ($("#nick-blank-save").is(":visible")) {var to_show = $("#un-success1")}		$("#current_name").text(name);		$("#us-nickname").val(name)		$("#username").dialog("close");		$("#nick-blank").val(name); 		$("#us-username").html(name)		to_show.show();		setTimeout(function() {			to_show.fadeOut(800, function() {to_show.hide()});		}, 1000)	} else {		$("#username .err-block").fadeIn();		if (status==1) {			if ($("#nick-blank-save").is(":visible"))  {alertWrongNick(1); $("#username .err-block").hide();}			else {$("#nick-error-msg1").show();}		} else if (status==3) {			$("#nick-error-msg3").show();		} else {			$("#nick-error-msg2").show();		}	}}function changeUserpic (url)  {	$(".userpic-dial .ui-dialog-buttonset").prepend('<img class="up-loader" src="/images/load.gif" style="position: relative; top: 5px; left: -20px">')	$.post("/users/change_userpic", { userpic: url} );}function userPicChanged(url) {	$("#pictures").dialog("close");	$("#userpic-img").attr("src", url);	$(".f-my-topic .t-userpic-img").attr("src", url);	if ($("#userpic-img").is(":hidden")==false) {		$("#userpic-img").css({backgroundColor: "#F0E805"}).animate({backgroundColor: "#fffff"},800);	}		$("#up-success").show();	setTimeout(function() {		$("#up-success").fadeOut(800, function() {$("#up-success").hide()});	}, 1000)	}</script><div id="pictures" style="display: none" align="left" title="Edit user picture"><table width="100%" cellspacing="0"><col width="200"><col>	<tr align="center" class="up-tips">		<td>Preview</td>		<td style="font-size: 10px">Choose an option and click "Save"</td>	</tr>	<tr valign="top">	<td align="center">	<span id="used-userpic"> <img src="<%= userpic_for(current_user) %>" width="80"></span>	<div class="used-txt-holder"><span id="used-txt"> Current picture</span></div>	</td>	<td><div class="pics-holder"><ul class="userpics-list">	<li>	<span> <img src="<%= gravatar_for(current_user) %>?d=identicon&f=y" width="30" ></span>	<div> Geometric figure</div>	</li>	<li>		<span> <img src="<%= gravatar_for(current_user) %>" width="30"></span>		<div> Customized on <a href="http://www.gravatar.com" target="_blank">www.gravatar.com</a></div>	</li>	<li>		<span> <img src="<%= gravatar_for(current_user) %>?d=wavatar&f=y" width="30"></span>		<div> Generated face</div>	</li>	<li>	<span> <img src="<%= gravatar_for(current_user) %>?d=monsterid&f=y" width="30"></span>	<div> Generated "monster"</div>	</li>	<li>	<span> <img src="<%= gravatar_for(current_user) %>?d=mm&f=y" width="30"></span>	<div> Mystery-man</div>	</li></ul></div>	</td>	<tr></table>	<div class="userpic-tip">Choose an avatar from the options above and click "Save". You can also upload or edit your avatar on <a href="http://www.gravatar.com" target="_blank">www.gravatar.com</a> </div></div><div id="username" title="Change nickname" style="display: none">			<div class="err-block" style="display: none;">				<div class="ui-state-error ui-corner-all" style="padding: 0 .7em;"> 					<p>						<span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span> 						<strong>Alert:</strong> 							<span id="nick-error-msg1" class="nick-error-msg">Nickname is already taken</span>							<span id="nick-error-msg2" class="nick-error-msg">Invalid nickname</span>							<span id="nick-error-msg3" class="nick-error-msg">Nickname is too long <span="white-space:nowrap;">(maximum 50 symbols)</span></span>					</p>				</div>			</div>	<div class="userinfo-edit">		<span style="display: none" id="current_name"><%= current_user.name %></span>	   <table cellspacing="5">		 <tr><td align="right">Nickname:</td><td><input autocomplete="off" id="us-nickname" value="" style="width: 300px;"/></td></tr>	   </table>	</div></div>